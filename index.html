<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global OSINT Identity Mapper</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        :root { --accent: #06b6d4; }
        body { background: #020617; color: #f8fafc; font-family: 'JetBrains Mono', monospace; }
        .cyber-border { border: 1px solid rgba(6, 182, 212, 0.2); background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(12px); }
        #map { height: 450px; border-radius: 1rem; filter: invert(90%) hue-rotate(180deg) brightness(0.8) contrast(1.2); }
        .data-glow { text-shadow: 0 0 10px rgba(6, 182, 212, 0.5); }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 md:p-8">

    <div class="max-w-7xl w-full grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <div class="lg:col-span-5 flex flex-col gap-6">
            <div class="cyber-border rounded-3xl p-8 relative overflow-hidden">
                <div class="absolute -top-4 -right-4 text-6xl font-black opacity-[0.03] select-none">GLOBAL</div>
                
                <div class="flex items-center justify-between mb-10 border-b border-white/5 pb-4">
                    <div class="flex items-center gap-3">
                        <span class="relative flex h-3 w-3">
                            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-cyan-400 opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-3 w-3 bg-cyan-500"></span>
                        </span>
                        <h1 class="text-xs font-bold tracking-[0.3em] uppercase">Identity Node Sync</h1>
                    </div>
                    <div id="country-tag" class="text-[10px] border border-cyan-500/50 px-2 py-1 rounded text-cyan-400 font-bold">DETECTING...</div>
                </div>

                <div class="space-y-8">
                    <div>
                        <label class="text-[10px] text-slate-500 uppercase font-bold mb-2 block tracking-widest">Legal Identity</label>
                        <p id="res-name" class="text-3xl font-bold tracking-tighter data-glow text-cyan-400">---</p>
                    </div>

                    <div class="grid grid-cols-2 gap-6">
                        <div class="bg-black/40 p-5 rounded-2xl border border-white/5">
                            <label class="text-[10px] text-slate-500 uppercase font-bold mb-2 block">Postal Code</label>
                            <span id="res-zip" class="text-xl font-bold text-white tracking-widest">------</span>
                        </div>
                        <div class="bg-black/40 p-5 rounded-2xl border border-white/5">
                            <label class="text-[10px] text-slate-500 uppercase font-bold mb-2 block">Mobile/TEL</label>
                            <span id="res-phone" class="text-sm font-bold text-white">---</span>
                        </div>
                    </div>

                    <div class="bg-cyan-500/5 p-6 rounded-2xl border border-cyan-500/10">
                        <label class="text-[10px] text-cyan-500 uppercase font-bold mb-2 block tracking-widest">Physical Residency (Detailed)</label>
                        <p id="res-address" class="text-sm leading-relaxed text-slate-300 italic">Connecting to geolocation gateway...</p>
                    </div>

                    <div class="flex justify-between items-center pt-6 border-t border-white/5">
                        <div class="text-[10px] text-slate-600">
                            IP: <span id="res-ip" class="text-cyan-900 font-bold">0.0.0.0</span>
                        </div>
                        <button onclick="syncGlobalIdentity()" class="px-8 py-3 bg-cyan-600 hover:bg-cyan-500 text-white text-xs font-black rounded-xl transition-all active:scale-95 shadow-lg shadow-cyan-900/20 uppercase tracking-widest">
                            Refresh Node
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="lg:col-span-7 cyber-border rounded-3xl p-4">
            <div id="map"></div>
            <div class="mt-4 flex justify-between px-2 text-[10px] text-slate-500 uppercase font-bold">
                <span>Vector: <span id="val-lat" class="text-cyan-600">0.0</span>, <span id="val-lon" class="text-cyan-600">0.0</span></span>
                <span>Provider: OpenStreetMap / ipapi</span>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // 1. 初始化地图
        let map = L.map('map', { zoomControl: false }).setView([20, 0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        let marker;

        // 2. 全球语言与地址数据库
        const WORLD_DB = {
            CN: { sn: "赵钱孙李周吴郑王冯陈", fn: "志强建国美丽欣怡浩然思睿", rd: ["中山路", "建设大道", "新华大街"], ds: ["静安区", "天河区", "朝阳区", "武侯区"] },
            US: { sn: ["Smith", "Johnson", "Williams", "Brown"], fn: ["James", "Emma", "Robert", "Olivia"], rd: ["Main St", "Park Ave", "Oak St", "Sunset Blvd"], ds: ["Downtown", "Riverside", "North End"] },
            JP: { sn: ["Sato", "Suzuki", "Takahashi", "Tanaka"], fn: ["Kenji", "Sakura", "Hiroshi", "Yuki"], rd: ["Chuo-dori", "Meiji-dori", "Station Lane"], ds: ["Shibuya", "Minato", "Shinjuku"] },
            DEFAULT: { sn: ["Garcia", "Müller", "Ivanov", "Silva"], fn: ["Alex", "Maria", "Jean", "Ken"], rd: ["High St", "Church Rd", "Market St"], ds: ["Central District", "Sector 4"] }
        };

        const pick = (arr) => Array.isArray(arr) ? arr[Math.floor(Math.random()*arr.length)] : arr[Math.floor(Math.random()*arr.length)];
        const rng = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

        // 3. 核心同步逻辑
        async function syncGlobalIdentity() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();

                // 更新基础坐标与 IP
                document.getElementById('res-ip').innerText = data.ip;
                document.getElementById('val-lat').innerText = data.latitude.toFixed(4);
                document.getElementById('val-lon').innerText = data.longitude.toFixed(4);
                document.getElementById('country-tag').innerText = data.country_name;

                // 地图交互
                const pos = [data.latitude, data.longitude];
                map.setView(pos, 13);
                if(marker) map.removeLayer(marker);
                marker = L.circle(pos, {radius: 500, color: '#06b6d4', fillOpacity: 0.3}).addTo(map);

                // 根据国家代码匹配库
                const cc = data.country_code;
                const db = WORLD_DB[cc] || WORLD_DB.DEFAULT;
                const isCN = (cc === 'CN');

                // A. 姓名逻辑 (中西格式切换)
                document.getElementById('res-name').innerText = isCN ? 
                    pick(db.sn) + pick(db.fn) : pick(db.fn) + " " + pick(db.sn);

                // B. 电话逻辑 (北美区号补全修复)
                let callCode = (data.country_calling_code || "").replace('+', '');
                if (cc === 'US' || cc === 'CA') {
                    // 北美标准 10 位: +1 (区号) XXX-XXXX
                    document.getElementById('res-phone').innerText = `+${callCode} (${rng(201, 989)}) ${rng(200, 999)}-${rng(1000, 9999)}`;
                } else if (isCN) {
                    // 中国标准 11 位: +86 1XX-XXXX-XXXX
                    document.getElementById('res-phone').innerText = `+86 1${pick(['3','5','7','8','9'])}${rng(0,9)}-${rng(1000,9999)}-${rng(1000,9999)}`;
                } else {
                    // 国际通用格式
                    document.getElementById('res-phone').innerText = `+${callCode} ${rng(10, 99)}-${rng(100, 999)}-${rng(1000, 9999)}`;
                }

                // C. 邮编逻辑 (位数自适应)
                document.getElementById('res-zip').innerText = (cc === 'US') ? rng(10001, 99950) : rng(101101, 854402);

                // D. 详细地址逻辑 (重构排版顺序)
                const district = pick(db.ds);
                const road = pick(db.rd);
                document.getElementById('res-address').innerText = isCN ?
                    `${data.region} ${data.city} ${district}${road}${rng(1, 1500)}号${rng(1, 20)}栋${rng(101, 2808)}室` :
                    `${rng(1, 9999)} ${road}, ${district}, ${data.city}, ${data.region}`;

            } catch (error) {
                console.error("GATEWAY_ERROR:", error);
                document.getElementById('res-address').innerText = "SYNCHRONIZATION FAILED. CHECK NETWORK PROXY.";
            }
        }

        // 初始化运行
        window.onload = syncGlobalIdentity;
    </script>
</body>
</html>
